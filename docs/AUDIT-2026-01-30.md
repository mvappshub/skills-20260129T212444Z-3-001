# SilvaPlan - Audit Report & Action Plan

**Datum:** 30. ledna 2026
**Autor:** Claude (Superpowers)
**Verze:** 0.1.0 (MVP post-Leaflet)

---

## ğŸ“Š Executive Summary

**AktuÃ¡lnÃ­ stav:** SilvaPlan je funkÄnÃ­ MVP s modernÃ­ MapLibre GL mapou a Supabase backendem. Aplikace umoÅ¾Åˆuje evidenci a plÃ¡novÃ¡nÃ­ vÃ½sadby stromÅ¯ po ÄŒR.

**HlavnÃ­ ÃºspÄ›chy:**
- âœ… ModernÃ­ MapLibre GL mapa (WebGL, CartoDB design)
- âœ… Supabase backend funkÄnÃ­
- âœ… 3 pohledy: KalendÃ¡Å™, Historie, Mapa
- âœ… GPS geolokace
- âœ… Data persistujÃ­ v databÃ¡zi

**KritickÃ© mezery:**
- âŒ PhotoCapture NEINTEGROVANÃ‰ (komponenta existuje ale nenÃ­ pouÅ¾Ã­vÃ¡na)
- âŒ Meteo alerts tabulka neexistuje (obeÅ¡lo se)
- âŒ Storage bucket pro fotky neexistuje
- âŒ Å½Ã¡dnÃ© testy
- âŒ PRAZDNÃ balÃ­Äek (leaflet, react-leaflet - mrtvÃ½ kÃ³d)

**DoporuÄenÃ­:** Prioritou je integrovat PhotoCapture (focenÃ­ stromÅ¯) a vytvoÅ™it Storage bucket. Meteo alerts mohou poÄkat.

---

## ğŸ” DetailnÃ­ Audit

### âœ… HOTOVÃ‰ (Production-Ready)

| Komponenta | Stav | PoznÃ¡mka |
|------------|------|----------|
| **Mapa (MapLibre GL)** | âœ… | WebGL, CartoDB Positron, plynulÃ© animace |
| **Supabase Client** | âœ… | `lib/supabase.ts` |
| **Event Service** | âœ… | CRUD pro events + event_items |
| **Tree Service** | âœ… | CRUD pro trees + tree_photos |
| **Alert Service** | âœ… | S workaround pro chybÄ›jÃ­cÃ­ tabulku |
| **Storage Service** | âœ… | Upload + save, ale bucket neexistuje |
| **GPS Hook** | âœ… | `useGeolocation.ts` |
| **History Sidebar** | âœ… | ChronologickÃ½ seznam, filtry |
| **PlanModal** | âœ… | S GPS tlaÄÃ­tkem |
| **DayDetailPanel** | âœ… | Detail vybranÃ©ho dne |
| **Types** | âœ… | KompletnÃ­ TypeScript typy |

### âŒ CHYBÄšJÃCÃ / NEFUNGUJÃCÃ

| Komponenta | ProblÃ©m | Priorita |
|------------|---------|----------|
| **PhotoCapture** | Existuje ALE nikde se nepouÅ¾Ã­vÃ¡ | ğŸ”´ VYSOKÃ |
| **Storage Bucket** | Supabase bucket 'tree-photos' neexistuje | ğŸ”´ VYSOKÃ |
| **Meteo Alerts Table** | Tabulka v Supabase neexistuje | ğŸŸ¡ STÅ˜EDNÃ |
| **Tests** | Å½Ã¡dnÃ© unit ani E2E testy | ğŸŸ¡ STÅ˜EDNÃ |
| **Leaflet balÃ­Äky** | MrtvÃ½ kÃ³d v package.json | ğŸŸ¢ NÃZKÃ |
| **Autentizace** | Å½Ã¡dnÃ¡ - veÅ™ejnÃ½ pÅ™Ã­stup | ğŸŸ¡ STÅ˜EDNÃ |
| **Clustering** | Pro 5000+ markerÅ¯ | ğŸŸ¢ NÃZKÃ |
| **PWA** | NenÃ­ instalovatelnÃ¡ | ğŸŸ¢ NÃZKÃ |

### âš ï¸ TECHNICKÃ DLUH

| Issue | Dopad | Odhad |
|-------|-------|-------|
| MrtvÃ½ kÃ³d (leaflet) | ZbytnÃ© balÃ­Äky | 5 min |
| Å½Ã¡dnÃ© testy | Riziko regresÃ­ | 2-4 hodiny |
| Å½Ã¡dnÃ¡ autentizace | VeÅ™ejnÃ¡ data | 4-8 hodin |
| NenÃ­ PWA | Nejde instalovat | 2-3 hodiny |

---

## ğŸ¯ PriorizovanÃ½ AkÄnÃ­ PlÃ¡n

### Sprint 1: Fotodokumentace (KRITICKÃ‰ - 2-3 hodiny)

**CÃ­l:** UmoÅ¾nit fotit stromy a uklÃ¡dat fotky do cloudu.

**Task 1.1: VytvoÅ™it Supabase Storage Bucket**
- JÃ­t do Supabase Dashboard â†’ Storage
- VytvoÅ™it bucket `tree-photos`
- Nastavit jako Public
- PÅ™idat RLS policies (public read/write)

**Task 1.2: Integrovat PhotoCapture do UI**
- PÅ™idat PhotoCapture do HistorySidebar (detail stromu)
- PÅ™idat do DayDetailPanel (u vysazenÃ½ch stromÅ¯)
- PÅ™idat do PlanModal (pÅ™i plÃ¡novÃ¡nÃ­ vÃ½sadby)

**Task 1.3: Propojit se Storage Service**
- Volat `uploadAndSavePhoto` po vyfocenÃ­
- Zobrazit loading state pÅ™i nahrÃ¡vÃ¡nÃ­
- ChybovÃ© hlÃ¡Å¡ky

**Task 1.4: Zobrazovat fotky u stromÅ¯**
- Gallery komponenta v detailu stromu
- NaÄÃ­tat z `tree.photos` pole

**Odhad:** 2-3 hodiny

---

### Sprint 2: ÄŒiÅ¡tÄ›nÃ­ (LOW-HANGING FRUIT - 30 minut)

**Task 2.1: Odstranit mrtvÃ½ Leaflet kÃ³d**
```bash
npm uninstall leaflet react-leaflet @types/leaflet
```

**Task 2.2: VyÄistit imports**
- Odstranit Leaflet CSS z index.html
- PÅ™idat MapLibre CSS (uÅ¾ je tam)

**Odhad:** 15-30 minut

---

### Sprint 3: Meteo Alerts (NICE-TO-HAVE - 1 hodina)

**Task 3.1: VytvoÅ™it tabulku v Supabase**
- Spustit SQL v Supabase SQL Editoru
- VytvoÅ™it tabulku `meteo_alerts`
- PÅ™idat RLS policies

**Task 3.2: Odebrat workaround**
- Upravit `alertService.ts` - vrÃ¡tit chyby
- Zobrazovat chyby uÅ¾ivateli

**Odhad:** 30-60 minut

---

### Sprint 4: TestovÃ¡nÃ­ (BEST PRACTICE - 2-4 hodiny)

**Task 4.1: Unit test pro services**
- Nastavit Vitest
- Otestovat eventService, treeService
- Mock Supabase klienta

**Task 4.2: E2E test pro kritickÃ© flows**
- Nastavit Playwright
- Test: vytvoÅ™it event
- Test: pÅ™idat strom
- Test: nahrÃ¡t fotku

**Odhad:** 2-4 hodiny

---

### Sprint 5: VylepÅ¡enÃ­ (OPTIONAL - 4-8 hodin)

**Task 5.1: Clustering markerÅ¯**
- Pro 5000+ stromÅ¯
- Supercluster nebo MapLibre clustering

**Task 5.2: Autentizace**
- Supabase Auth
- Google/Email login

**Task 5.3: PWA**
- Manifest
- Service Worker
- Installabilita

**Odhad:** 4-8 hodin

---

## ğŸ“‹ Roadmap vs Realita

| FÃ¡ze | PlÃ¡n | Realita | Gap |
|-------|------|---------|-----|
| **FÃ¡ze 1: Backend** | âœ… Hotovo | âœ… Hotovo | - |
| **FÃ¡ze 2: Geo** | âœ… Hotovo | âœ… Hotovo (MapLibre mÃ­sto Leaflet) | LepÅ¡Ã­ |
| **FÃ¡ze 3: Foto** | âŒ | âš ï¸ ÄŒÃ¡sti hotovo, neintegrovÃ¡no | Integration |
| **FÃ¡ze 4: AI** | âŒ | âŒ | BudoucÃ­ |
| **Tech Debt** | âŒ | âš ï¸ ÄŒÃ¡sti | Testy, PWA |

---

## ğŸš€ DoporuÄenÃ½ Postup

### SCÃ‰NAÅ˜ A: MinimÃ¡lnÃ­ Viable Produkt (Dnes)
1. **Sprint 1** - Fotodokumentace (2-3 hod)
2. **Sprint 2** - ÄŒiÅ¡tÄ›nÃ­ (30 min)
3. **Hotovo pro demo/beta**

### SCÃ‰NAÅ˜ B: Production-Ready (Tento tÃ½den)
1. Sprinty 1-4 (celkem ~6 hodin)
2. **Hotovo pro reÃ¡lnÃ½ provoz**

### SCÃ‰NAÅ˜ C: PoloprofesionÃ¡lnÃ­ (BudoucÃ­)
1. VÅ¡echny sprinty (celkem ~15 hodin)
2. + Autentizace, PWA, AI

---

## ğŸ’¡ OkamÅ¾itÃ© akce (dnes veÄer)

1. **VytvoÅ™it Storage bucket v Supabase** (5 min)
   - Dashboard â†’ Storage â†’ New bucket â†’ "tree-photos"
2. **Odinstalovat Leaflet** (2 min)
   ```bash
   npm uninstall leaflet react-leaflet @types/leaflet
   ```
3. **Testovat aplikaci** (5 min)
   - OtevÅ™Ã­t http://localhost:3001
   - Zkusit vytvoÅ™it event
   - Zkusit GPS tlaÄÃ­tko

---

## ğŸ¯ Success Metrics

| Metrika | AktuÃ¡lnÃ­ | CÃ­l |
|---------|----------|-----|
| FunkÄnÃ­ features | 8/12 | 12/12 |
| PokrytÃ­ fotodokumentace | 0% | 100% |
| Test coverage | 0% | 50%+ |
| MrtvÃ½ kÃ³d | ~2MB | 0 |
| Performance | DobrÃ¡ | VÃ½bornÃ¡ |

---

## ğŸ“ PoznÃ¡mky

- **MapLibre GL** byl skvÄ›lÃ½ nÃ¡hrada za Leaflet âœ…
- **Supabase backend** funguje perfektnÄ› âœ…
- **PhotoCapture integration** je nejvÄ›tÅ¡Ã­ prioritou âŒ
- **Testy** by se mÄ›ly pÅ™idat pÅ™ed productionem âš ï¸

---

**DalÅ¡Ã­ krok:** MÃ¡m zaÄÃ­t se Sprintem 1 (Fotodokumentace) nebo chceÅ¡ nejdÅ™Ã­v Sprint 2 (ÄŒiÅ¡tÄ›nÃ­)?
